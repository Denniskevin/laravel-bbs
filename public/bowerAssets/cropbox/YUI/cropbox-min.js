YUI.add("crop-box",function(t){t.cropbox=t.Base.create("crop-box",t.Base,[],{initializer:function(t){this.options=t,this.state={},this.render()},render:function(){return this.imageBox=t.one(this.options.imageBox),this.thumbBox=this.imageBox.one(this.options.thumbBox),this.spinner=this.imageBox.one(this.options.spinner),this.initObject(),this},initObject:function(){var i=this;this.spinner.show(),this.image=new Image,this.image.onload=function(){i.spinner.hide(),i.setBackground(),i.imageBox.on("mousedown",i.imgMouseDown,i),i.imageBox.on("mousemove",i.imgMouseMove,i),i.mouseup=t.one("body").on("mouseup",i.imgMouseUp,i),t.UA.gecko>0?i.imageBox.on("DOMMouseScroll",i.zoomImage,i):i.imageBox.on("mousewheel",i.zoomImage,i)},this.image.src=this.options.imgSrc},setBackground:function(){this.ratio||(this.ratio=1);var t=parseInt(this.image.width)*this.ratio,i=parseInt(this.image.height)*this.ratio,e=(this.imageBox.get("clientWidth")-t)/2,o=(this.imageBox.get("clientHeight")-i)/2;this.imageBox.setAttribute("style","background-image: url("+this.image.src+"); background-size: "+t+"px "+i+"px; background-position: "+e+"px "+o+"px; background-repeat: no-repeat")},imgMouseDown:function(t){t.stopImmediatePropagation(),this.state.dragable=!0,this.state.mouseX=t.clientX,this.state.mouseY=t.clientY},imgMouseMove:function(t){if(t.stopImmediatePropagation(),this.state.dragable){var i=t.clientX-this.state.mouseX,e=t.clientY-this.state.mouseY,o=this.imageBox.getStyle("backgroundPosition").split(" "),s=i+parseInt(o[0]),a=e+parseInt(o[1]);this.imageBox.setStyle("backgroundPosition",s+"px "+a+"px"),this.state.mouseX=t.clientX,this.state.mouseY=t.clientY}},imgMouseUp:function(t){t.stopImmediatePropagation(),this.state.dragable=!1},zoomImage:function(t){this.ratio*=t.wheelDelta>0?1.1:.9,this.setBackground()},getAvatar:function(){var t=this.thumbBox.get("clientWidth"),i=this.thumbBox.get("clientHeight"),e=document.createElement("canvas"),o=this.imageBox.getStyle("backgroundPosition").split(" "),s=this.imageBox.getStyle("backgroundSize").split(" "),a=parseInt(o[0])-this.imageBox.get("clientWidth")/2+t/2,n=parseInt(o[1])-this.imageBox.get("clientHeight")/2+i/2,h=parseInt(s[0]);dh=parseInt(s[1]),sh=parseInt(this.image.height),sw=parseInt(this.image.width),e.width=t,e.height=i;var g=e.getContext("2d");g.drawImage(this.image,0,0,sw,sh,a,n,h,dh);var r=e.toDataURL("image/jpeg");return r},zoomIn:function(){this.ratio*=1.1,this.setBackground()},zoomOut:function(){this.ratio*=.9,this.setBackground()},destructor:function(){this.mouseup&&this.mouseup.detach()}})},"1.0",{requires:["node","base"]});